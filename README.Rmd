---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(dplyr)

intovalue_all <- readr::read_csv(here::here("data", "intovalue.csv"))
```

# IntoValue Dataset

## Overview

This dataset is modified from the [main IntoValue dataset](https://github.com/quest-bih/IntoValue2/blob/master/data/iv_main_dataset.csv), and includes updated registry data from ClinicalTrials.gov and DRKS queried in May 2021. It also includes additional data on associated results publications, including links in the registries and trial registration number reporting in the publications.

The documentation for the parent IntoValue dataset is provided in a [data dictionary](https://github.com/quest-bih/IntoValue2/blob/master/data/iv_data_dictionary.csv) and [readme](https://github.com/quest-bih/IntoValue2/blob/master/data/iv_data_readme.txt).

This readme serves to highlight/document changes.

## Analysis dataset
We are interested in interventional trials with a German UMC lead completed between 2009 and 2017. Due to changes in the registry as well as discrepancies between IntoValue 1 and 2, we re-apply the IntoValue exclusion criteria and deduplicate to get the analysis dataset.

```{r filter-intovalue}
intovalue <-
  intovalue_all %>% 
  
  # In case of dupes, exclude IV1 version
  mutate(is_not_iv1_dupe = if_else(!(is_dupe & iv_version == 1), TRUE, FALSE)) %>% 
  
  filter(
    iv_completion,
    iv_status,
    iv_interventional,
    has_german_umc_lead,
    is_not_iv1_dupe
  )

n_iv_trials <- nrow(intovalue)
```
**Number of included trials**: `r n_iv_trials`

Some analyses apply only to trials with a results publication with a PMID that resolves to a PubMed record and for which we could acquire the full-text as a PDF. 

```{r trials-with-pubs}

intovalue_pubs <-
  intovalue %>% 
  filter(
    has_publication,
    has_pmid,
    has_pubmed,
    has_ft_pdf
  )

n_iv_trials_pubs <- nrow(intovalue_pubs)
trials_same_pmid <- janitor::get_dupes(intovalue_pubs, pmid)
n_trials_same_pmid <- n_distinct(trials_same_pmid$id)
n_pmids_same_trial <- n_distinct(trials_same_pmid$pmid)
n_pmids_dupes <- unique(range(trials_same_pmid$dupe_count))
```
**Number of trials with results publications**: `r n_iv_trials_pubs`

In general, there is max 1 publication per trial and max 1 trial per publication. However, there are `r n_trials_same_pmid` trials associated with the same `r n_pmids_same_trial` publications (i.e., `r n_pmids_dupes` publications per trial). Since the unit of analysis is trials, we disregard this double-counting of publications.

## TRN reporting in abstract

```{r trn-abs}
n_trn_abs <- nrow(filter(intovalue_pubs, has_iv_trn_abstract))

prop_trn_abs <- n_trn_abs/n_iv_trials_pubs
```

<!-- $$ \text{TRN in abstract (%)} = \frac{\text{Number of trials with PubMed publications with TRN in abstract}}{\text{Number of trials with PubMed publications available as PDF full-text}}$$ -->

**Numerator**: Number of trials with PubMed publications with IntoValue TRN in abstract

**Denominator**: Number of trials with PubMed publications available as PDF full-text

`r scales::percent(prop_trn_abs)` (`r n_trn_abs`/`r n_iv_trials_pubs`) of trials report a TRN in the abstract of their results publication.

## TRN reporting in full-text

```{r trn-ft}
n_trn_ft <- nrow(filter(intovalue_pubs, has_iv_trn_ft_pdf))

prop_trn_ft <- n_trn_ft/n_iv_trials_pubs
```

**Numerator**: Number of trials with PubMed publications with IntoValue TRN in PDF full-text

**Denominator**: Number of trials with PubMed publications available as PDF full-text

`r scales::percent(prop_trn_ft)` (`r n_trn_ft`/`r n_iv_trials_pubs`) of trials report a TRN in the full-text (PDF) of their results publication.

## Linked publication in registry

```{r reg-pub-link}

# ClinicalTrials.gov
intovalue_ctgov <- filter(intovalue_pubs, registry == "ClinicalTrials.gov")

n_iv_trials_pubs_ctgov <- nrow(intovalue_ctgov)

n_reg_pub_link_ctgov <- nrow(filter(intovalue_ctgov, has_reg_pub_link))

prop_reg_pub_link_ctgov <- n_reg_pub_link_ctgov/ n_iv_trials_pubs_ctgov

n_auto <- nrow(filter(intovalue_ctgov, reference_derived))
n_manual <- nrow(filter(intovalue_ctgov, reference_derived))

# DRKS
intovalue_drks <- filter(intovalue_pubs, registry == "DRKS")

n_iv_trials_pubs_drks <- nrow(intovalue_drks)

n_reg_pub_link_drks <- nrow(filter(intovalue_drks, has_reg_pub_link))

prop_reg_pub_link_drks <- n_reg_pub_link_drks/ n_iv_trials_pubs_drks

```

*Registry Limitations*: ClinicalTrials.gov includes a often-used PMID field for references. In addition, ClinicalTrials.gov automatically indexes publications from PubMed using TRN in the secondary identifier field. In contrast, DRKS includes references as a free-text field, leaving trialists to decide whether to enter any publication identifiers.

We consider a publication "linked" if the PMID or DOI is included in the trial registrations. Note that some publications are included in the registrations without a PMID or DOI (i.e., publication title and/or URL only).

**Numerator**: Number of trials with PubMed publications PMIDs and/or DOIs linked in trial registration

**Denominator**: Number of trials with PubMed publications available as PDF full-text

`r scales::percent(prop_reg_pub_link_ctgov)` (`r n_reg_pub_link_ctgov`/`r n_iv_trials_pubs_ctgov`) of trials on clinicaltrials.gov include a link (i.e., PMID, DOI) to their PubMed publication (as available in the IntoValue dataset). This includes `r n_auto` (`r scales::percent(n_auto/n_reg_pub_link_ctgov)`) trials with automatically indexed publications (i.e., using TRN in PubMed's secondary identifier field) and `r n_manual` (`r scales::percent(n_manual/n_reg_pub_link_ctgov)`) trials with manually added publications.

`r scales::percent(prop_reg_pub_link_drks)` (`r n_reg_pub_link_drks`/`r n_iv_trials_pubs_drks`) of trials on DRKS include a link (i.e., PMID, DOI) to their PubMed publication (as available in the IntoValue dataset).

## Registry summary results

```{r}
intovalue_pubs %>% 
  count(registry, has_summary_results) %>% 
  knitr::kable()
```

*Registry Limitations*: ClinicalTrials.gov includes a structured summary results field. In contrast, DRKS includes summary results with other references, and summary results were inferred based on keywords, such as Ergebnisbericht or Abschlussbericht, in the reference title.
